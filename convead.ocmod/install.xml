<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>Convead</name>
    <version>2.1</version>
    <author>Convead</author>
    <code>convead</code>
	<file path="catalog/controller/checkout/cart.php">
		<operation>
			<search regex="false"><![CDATA[$this->cart->add($this->request->post['product_id'], $quantity, $option, $recurring_id);]]></search>
			<add position="after"><![CDATA[
				$this->load->model('setting/setting');
				if ($convead_status = $this->config->get('convead_status')) {		
					$this->load->model('module/convead');
					$this->model_module_convead->updateCart();
				}
			]]></add>
		</operation>
		<operation>
			<search regex="true" limit="1"><![CDATA[/function(.*)remove(.*)[\s\S]*?\$this->response->setOutput[\s\S]*?[\n\r]/i]]></search>
			<add><![CDATA[$0 		
				$this->load->model('setting/setting');
				if ($convead_status = $this->config->get('convead_status')) {
					$this->load->model('module/convead');
					$this->model_module_convead->updateCart();			
				}
			]]></add>
		</operation>
		<operation>
			<search regex="true" limit="1"><![CDATA[/function(.*)edit(.*)[\s\S]*?reward[\s\S]*?[\n\r]/i]]></search>
			<add><![CDATA[$0 		
				$this->load->model('setting/setting');
				if ($convead_status = $this->config->get('convead_status')) {
					$this->load->model('module/convead');
					$this->model_module_convead->updateCart();			
				}
			]]></add>
		</operation>
	</file>
  <file path="catalog/controller/checkout/success.php">
		<operation>
			<search regex="true" limit="1"><![CDATA[/\$this->load->language[\s\S]*?[\n\r]/i]]></search>
			<add><![CDATA[$0 		
				$this->load->model('setting/setting');
				if ($convead_status = $this->config->get('convead_status') and !empty($this->session->data['order_id'])) {
					$this->load->model('module/convead');
					$this->model_module_convead->orderAdd($this->session->data['order_id']);		
				}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation>
			<search regex="true" limit="1"><![CDATA[/function(.*)index(.*)\((.*)\)(.*)\{/i]]></search>
			<add><![CDATA[$0 		
				$this->load->model('setting/setting');
				if ($convead_status = $this->config->get('convead_status')) {
					$this->load->model('module/convead');
					if ($this->request->get['product_id']) $this->model_module_convead->productViewed($this->request->get['product_id']);		
				}
			]]></add>
		</operation>
	</file>

	<file path="catalog/controller/payment/payanyway.php">
		<operation>
			<search regex="true" limit="1"><![CDATA[/\$data[\'order_id\'] = \$order_id;[\s\S]*?[\n\r]/i]]></search>
			<add><![CDATA[$0 	
			  /* support payanyway module */	
				$this->load->model('module/convead');
				$this->model_module_convead->orderAdd($order_id);
			]]></add>
		</operation>
	</file>


	<file path="catalog/controller/module/kw_flycart.php">
		<operation>
			<search regex="false"><![CDATA[return $this->loader();]]></search>
			<add position="before"><![CDATA[
			  /* support kw_flycart module */	
				$this->load->model('module/convead');
				$this->model_module_convead->updateCart();	
			]]></add>
		</operation>
	</file>

	<file path="catalog/controller/checkout/simplecheckout_cart.php">
		<operation>
			<search regex="false"><![CDATA[if (!$this->cart->hasProducts() && empty($this->session->data['vouchers'])) {]]></search>
			<add position="before"><![CDATA[
			  /* support simple cart module */	
			  if (!empty($this->request->post['remove']) or !empty($this->request->post['quantity'])) {
					$this->load->model('module/convead');
					$this->model_module_convead->updateCart();	
				}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/checkout/simplecheckout.php">
		<operation>
			<search regex="false"><![CDATA[$this->session->data['order_id'] = $order_id;]]></search>
			<add position="after"><![CDATA[
			  /* support simple checkout module */	
				$this->load->model('module/convead');
				$this->model_module_convead->orderAdd($order_id);
			]]></add>
		</operation>
	</file>

</modification>